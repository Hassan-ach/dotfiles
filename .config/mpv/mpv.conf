# ============================
# MPV Configuration for YouTube
# Vim-style keybindings + Slow Network Optimization
# Save as: ~/.config/mpv/mpv.conf
# ============================

# === YT-DLP SETTINGS ===
# Use yt-dlp as the downloader (better than youtube-dl)
script-opts=ytdl_hook-ytdl_path=yt-dlp

# Video format selection:
#   - Try best video + audio up to 720p (separate streams for smoother playback)
#   - Fallback to combined streams if separate not available
# ytdl-format="bv*[height<=1080]+ba/b[height<=1080]/bv*+ba/b"
# ytdl-format="bestvideo[height<=720][vcodec^=avc1]+bestaudio/best"
# Prefer H.264 AVC1 instead of AV1 for better compatibility
# ytdl-format="bestvideo[ext=mp4][vcodec^=avc1]+bestaudio[ext=m4a]/best[ext=mp4]"


# === CACHE FOR SLOW NETWORKS ===
cache=yes                  # Enable disk & memory caching to reduce buffering
cache-pause=yes            # Pause playback until cache is sufficiently filled
cache-pause-initial=yes    # Also pause at start until buffered enough
demuxer-max-bytes=150M     # Max buffer size for demuxer (increased for slow net)
demuxer-max-back-bytes=75M # Back buffer size for seeking backwards
cache-secs=60              # Preload 60 seconds ahead for smoother playback
network-timeout=60         # Network timeout in seconds (longer for slow internet)

# === VIDEO SETTINGS ===
hwdec=auto-safe            # Hardware decoding enabled, but safe fallback
vo=gpu                     # Use GPU for video output (fast & smooth)
profile=gpu-hq             # High quality video profile (may be heavy on weak GPUs)
scale=ewa_lanczossharp     # Scaling algorithm (sharp & smooth)
cscale=ewa_lanczossharp    # Chroma scaling
video-sync=display-resample # Synchronize video with display refresh
interpolation=yes          # Enable frame interpolation (smoother motion)
tscale=oversample          # Time scaling for better interpolation quality

# === AUDIO SETTINGS ===
audio-file-auto=fuzzy      # Auto-load matching external audio files if available
audio-normalize-downmix=yes # Normalize audio when downmixing channels
volume=70                  # Default volume level at 70%
volume-max=150             # Allow volume boost up to 150%

# === INTERFACE ===
keep-open=yes              # Keep window open after video ends
osd-bar=yes                # Show progress bar on screen
osd-duration=2000          # Progress bar visible for 2 seconds
osd-font-size=32           # Font size for on-screen display elements
title="${filename}"        # Window title shows current filename or video title

# === SUBTITLE SETTINGS ===
sub-auto=exact             # Load only exact matching subtitles (avoid wrong ones)
sub-font-size=44           # Subtitle font size (large & readable)
sub-color="#FFFFFF"        # Subtitle text color: white
sub-border-color="#000000" # Subtitle border color: black (for contrast)
sub-border-size=2          # Thickness of subtitle border
sub-shadow-offset=2        # Shadow offset for subtitles
sub-shadow-color="#000000" # Shadow color: black

# === SCREENSHOT SETTINGS ===
screenshot-format=png      # Save screenshots in PNG format
screenshot-png-compression=8 # PNG compression level (balanced size/quality)
screenshot-directory="~/Pictures/mpv-screenshots" # Where screenshots are saved
screenshot-template="%F-%wH.%wM.%wS" # Filename template with date & time

# === PERFORMANCE ===
# vd-lavc-threads=4        # (Optional) Use 4 decoder threads for weak CPUs (uncomment if needed)

# === PLAYLIST BEHAVIOR ===
playlist-start=0           # Start at first item when loading playlist

# === LOGGING ===
msg-level=all=info        # Show info-level messages in mpv logs
# msg-level=all=debug
#
save-position-on-quit
